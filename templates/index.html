{% extends 'base.html' %}

{% block content %}
<section class="grid grid-2">
  <!-- CHAT PANEL -->
  <div class="card chat">
    <div class="card-header">
      <h2>Chatbot</h2>
      <div class="spacer"></div>
      <button class="btn" id="btn-history" type="button">L·ªãch s·ª≠</button>
      <button class="btn" id="btn-new-chat" type="button">ƒêo·∫°n chat m·ªõi</button>
      <div class="badge" id="mode-badge">Catalog</div>
    </div>

    <div class="chat-body" id="messages" aria-live="polite">
      <div class="bubble bot">
        Xin ch√†o üëã B·∫°n c√≥ th·ªÉ tra c·ª©u s√°ch (t√™n/t√°c gi·∫£/th·ªÉ lo·∫°i)
        ho·∫∑c g√µ <code>mua "T√™n S√°ch"</code> ƒë·ªÉ ƒë·∫∑t h√†ng.
      </div>
    </div>

    <form class="chat-input" id="chat-form" autocomplete="off">
      <input
        type="text"
        id="msg"
        placeholder="Nh·∫≠p tin nh·∫Øn..."
        aria-label="Tin nh·∫Øn"
        autofocus
      />
      <button class="btn btn-primary" type="submit">G·ª≠i</button>
    </form>
  </div>

  <!-- STATUS / SIDEBAR -->
  <aside class="card">
    <div class="card-header"><h3>Tr·∫°ng th√°i</h3></div>
    <div class="card-body">
      <div class="kv">
        <span>Session:</span> <code id="sid">{{ session_id }}</code>
      </div>
      <div class="kv">
        <span>Realtime:</span> <b id="wsstate">connecting‚Ä¶</b>
      </div>
      <hr class="sep" />
      <p class="muted">
        Khi admin duy·ªát/h·ªßy, th√¥ng b√°o s·∫Ω hi·ªán ngay t·∫°i c·ª≠a s·ªï chat.
        B·∫°n c√≥ th·ªÉ xem l·∫°i c√°c cu·ªôc tr√≤ chuy·ªán tr∆∞·ªõc trong m·ª•c <b>L·ªãch s·ª≠</b>.
      </p>
    </div>
  </aside>
</section>

<!-- MODAL: L·ªäCH S·ª¨ SESSION -->
<div class="modal" id="sessions-modal" aria-hidden="true" role="dialog" aria-label="L·ªãch s·ª≠ phi√™n chat">
  <div class="modal-backdrop" onclick="closeSessionsModal()"></div>
  <div class="modal-card" role="document">
    <div class="card-header between">
      <h3>Ch·ªçn cu·ªôc tr√≤ chuy·ªán</h3>
      <button class="btn" type="button" onclick="closeSessionsModal()" aria-label="ƒê√≥ng">‚úï</button>
    </div>
    <div class="card-body">
      <ul id="sessions-list" class="sessions-list"></ul>
      <p class="muted" id="sessions-empty" style="display:none">Ch∆∞a c√≥ l·ªãch s·ª≠ n√†o.</p>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  // truy·ªÅn session hi·ªán h√†nh cho JS
  window.__SESSION_ID__ = "{{ session_id }}";
</script>
<script src="/static/js/chat.js" defer></script>
{% endblock %}
